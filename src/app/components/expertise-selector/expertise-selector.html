<div class="expertise-selector-container">
  <div class="expertise-header">
    <h2>Expertise Selection</h2>
    <div class="expertise-points">
      <mat-icon>school</mat-icon>
      <span>Available Points: {{ availablePoints }} / {{ totalPoints }}</span>
    </div>
  </div>

  <div class="expertise-info">
    <p>
      Select expertises based on your character's background and training. 
      You receive <strong>2 cultural expertises</strong> from your chosen culture(s) automatically, 
      plus additional expertises equal to your <strong>Intellect score ({{ totalPoints }})</strong>.
    </p>
    <p *ngIf="culturalExpertises.length > 0" class="cultural-info">
      <mat-icon>public</mat-icon>
      <strong>Cultural Expertises from your culture(s):</strong> {{ culturalExpertises.join(', ') }}
      <span class="cultural-note">(These can be deselected if desired)</span>
    </p>
  </div>

  <div class="validation-message" *ngIf="validationMessage">
    <mat-icon>{{ availablePoints >= 0 ? 'info' : 'warning' }}</mat-icon>
    <span>{{ validationMessage }}</span>
  </div>

  <div class="expertise-categories">
    <div class="category-section" *ngFor="let category of categories">
      <div class="category-header">
        <mat-icon class="category-icon">{{ getCategoryIcon(category) }}</mat-icon>
        <div class="category-text">
          <h3>{{ getCategoryTitle(category) }}</h3>
          <p class="category-description">{{ getCategoryDescription(category) }}</p>
        </div>
      </div>
      
      <div class="expertise-grid">
        <mat-card 
          *ngFor="let expertise of getExpertisesByCategory(category)"
          class="expertise-card"
          [class.selected]="isExpertiseSelected(expertise)"
          [class.cultural-auto]="isCulturalExpertise(expertise)"
          [class.available]="canSelectExpertise(expertise)"
          [class.locked]="!canSelectExpertise(expertise) && !isExpertiseSelected(expertise)"
          [attr.data-category]="category"
          (click)="toggleExpertise(expertise)">
          
          <mat-card-header>
            <mat-card-title>
              <mat-icon class="expertise-icon">{{ getCategoryIcon(category) }}</mat-icon>
              {{ expertise.name }}
              <mat-chip *ngIf="isCulturalExpertise(expertise)" class="auto-chip">
                <mat-icon>stars</mat-icon>
                From Culture
              </mat-chip>
            </mat-card-title>
          </mat-card-header>
          
          <mat-card-content>
            <p>{{ expertise.description }}</p>
          </mat-card-content>
          
          <mat-card-actions>
            <button 
              mat-button 
              *ngIf="isExpertiseSelected(expertise)"
              (click)="toggleExpertise(expertise); $event.stopPropagation()"
              color="warn">
              <mat-icon>remove_circle</mat-icon>
              Remove
            </button>
            <button 
              mat-button 
              *ngIf="!isExpertiseSelected(expertise) && canSelectExpertise(expertise)"
              (click)="toggleExpertise(expertise); $event.stopPropagation()"
              color="primary">
              <mat-icon>add_circle</mat-icon>
              Select
            </button>
          </mat-card-actions>
        </mat-card>
      </div>
    </div>
  </div>

  <div class="selected-summary">
    <h3>Selected Expertises ({{ selectedExpertises.length }})</h3>
    <mat-chip-set>
      <mat-chip 
        *ngFor="let expertise of selectedExpertises"
        [removable]="canRemoveExpertise(expertise.name)"
        (removed)="removeExpertiseByName(expertise.name)">
        {{ expertise.name }}
        <span class="expertise-source-badge" [class]="'badge-' + expertise.source">
          {{ getSourceBadge(expertise.name) }}
        </span>
        <mat-icon matChipRemove *ngIf="canRemoveExpertise(expertise.name)">cancel</mat-icon>
      </mat-chip>
    </mat-chip-set>
  </div>
</div>

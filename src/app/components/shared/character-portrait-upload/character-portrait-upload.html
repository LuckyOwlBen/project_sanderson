<div class="portrait-upload-dialog">
  <h2 mat-dialog-title>
    <mat-icon>portrait</mat-icon>
    {{ data.characterName }}'s Portrait
  </h2>

  <mat-dialog-content>
    <div class="dialog-content">
      <p class="instruction-text">
        Upload a character portrait image. It will be automatically compressed to WebP format for optimal storage.
      </p>

      <app-image-uploader
        [currentImageUrl]="uploadedImageUrl"
        [characterId]="data.characterId"
        [imageType]="'portrait'"
        [label]="'Character Portrait'"
        [showPreview]="true"
        (imageUploaded)="onImageUploaded($event)"
        (imageRemoved)="onImageRemoved()">
      </app-image-uploader>

      <div class="cached-images-section" *ngIf="cachedImages.length > 0">
        <h4>
          <mat-icon>photo_library</mat-icon>
          Saved Portraits ({{ cachedImages.length }})
        </h4>
        <p class="helper-text">Click to select, or delete unused portraits to free storage</p>
        <div class="cached-images-grid">
          <div 
            *ngFor="let image of cachedImages" 
            class="cached-image-item"
            [class.selected]="uploadedImageUrl === image.url">
            <img [src]="image.url" [alt]="image.characterName || 'Portrait'">
            <div class="image-overlay">
              <span class="character-name">{{ image.characterName }}</span>
              <div class="action-buttons">
                <button 
                  mat-icon-button 
                  class="select-btn"
                  [matTooltip]="'Use this portrait'"
                  (click)="selectCachedImage(image.url)">
                  <mat-icon>check_circle</mat-icon>
                </button>
                <button 
                  mat-icon-button 
                  class="delete-btn"
                  [matTooltip]="'Delete this portrait'"
                  (click)="deleteCachedImage(image, $event)">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="tips-section">
        <h4>Tips:</h4>
        <ul>
          <li>Square images work best (e.g., 512x512px)</li>
          <li>Use clear, well-lit photos or artwork</li>
          <li>Images are resized to 800x800px max</li>
          <li>Supported formats: JPG, PNG, WebP (max 10MB)</li>
        </ul>
      </div>
    </div>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button (click)="onCancel()">
      Cancel
    </button>
    <button mat-raised-button color="primary" (click)="onSave()">
      <mat-icon>check</mat-icon>
      Save Portrait
    </button>
  </mat-dialog-actions>
</div>

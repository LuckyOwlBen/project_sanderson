<div class="character-creator-container">
    <!-- Level-Up Mode Banner -->
    <div class="level-up-banner" *ngIf="isLevelUpMode">
        <mat-card class="level-up-info-card">
            <mat-icon>trending_up</mat-icon>
            <div class="level-up-text">
                <strong>Level-Up Mode</strong>
                <span>Complete the following steps to advance your character</span>
            </div>
        </mat-card>
    </div>

    <div class="creator-main">

        <!-- The router-outlet will render the child component here -->
        <router-outlet></router-outlet>

        <div class="stepper-buttons">
            <button mat-button (click)="previousStep()" [disabled]="!canGoPrevious()">
                Back
            </button>
            <button *ngIf="currentStep < steps.length - 1 || isLevelUpMode" mat-raised-button color="primary" (click)="nextStep()" [disabled]="!canGoNext()">
                {{ isLevelUpMode && currentStep >= steps.length - 2 ? 'Complete Level-Up' : 'Next' }}
            </button>
        </div>
    </div>

    <!-- Floating character preview (hidden until skills page) -->
    <div class="character-preview" *ngIf="currentStep >= 4">
        <mat-card>
            <mat-card-header>
                <mat-card-title>Character Preview</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <div *ngIf="characterState.character$ | async as character" class="preview-content">
                    <!-- Compact Basic Info -->
                    <div class="preview-section compact">
                        <h3>{{ character.name || 'Unnamed' }}</h3>
                        <div class="basic-info-grid">
                            <span><strong>Level:</strong> {{ character.level }}</span>
                            <span><strong>Ancestry:</strong> {{ character.ancestry || 'Not selected' }}</span>
                        </div>
                        <div class="basic-info-grid" *ngIf="character.cultures.length > 0">
                            <span><strong>Culture:</strong> {{ getCultureNames(character) }}</span>
                        </div>
                        <div class="basic-info-grid" *ngIf="character.paths.length > 0">
                            <span><strong>Path:</strong> {{ getPathNames(character) }}</span>
                        </div>
                    </div>

                    <!-- Attributes -->
                    <div class="preview-section">
                        <h3>Attributes</h3>
                        <div class="attributes-grid">
                            <div class="attribute-item">
                                <span class="attr-label">STR:</span>
                                <span class="attr-value">{{ character.attributes.strength }}</span>
                            </div>
                            <div class="attribute-item">
                                <span class="attr-label">SPD:</span>
                                <span class="attr-value">{{ character.attributes.speed }}</span>
                            </div>
                            <div class="attribute-item">
                                <span class="attr-label">INT:</span>
                                <span class="attr-value">{{ character.attributes.intellect }}</span>
                            </div>
                            <div class="attribute-item">
                                <span class="attr-label">WIL:</span>
                                <span class="attr-value">{{ character.attributes.willpower }}</span>
                            </div>
                            <div class="attribute-item">
                                <span class="attr-label">AWR:</span>
                                <span class="attr-value">{{ character.attributes.awareness }}</span>
                            </div>
                            <div class="attribute-item">
                                <span class="attr-label">PRE:</span>
                                <span class="attr-value">{{ character.attributes.presence }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Skills -->
                    <div class="preview-section">
                        <h3>Skills</h3>
                        <div class="skills-grid">
                            <div *ngFor="let skill of getTrainedSkills(character)" class="skill-item">
                                <span class="skill-name">{{ skill.name }}</span>
                                <span class="skill-rank">{{ skill.rank }}</span>
                            </div>
                            <p *ngIf="getTrainedSkills(character).length === 0" class="empty-text">No skills trained</p>
                        </div>
                    </div>

                    <!-- Talents -->
                    <div class="preview-section" *ngIf="getUnlockedTalents(character).length > 0">
                        <h3>Talents</h3>
                        <div class="talents-list">
                            <div *ngFor="let talent of getUnlockedTalents(character)" class="talent-item">
                                <strong>{{ talent.name }}</strong>
                                <span class="talent-tier">Tier {{ talent.tier }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </mat-card-content>
        </mat-card>
    </div>
</div>

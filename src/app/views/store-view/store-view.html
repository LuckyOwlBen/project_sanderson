<div class="store-container" *ngIf="character && storeEnabled">
  <!-- Store Header -->
  <div class="store-header">
    <div class="header-content">
      <span class="store-icon">ğŸª</span>
      <div class="header-text">
        <h1>General Store</h1>
        <p class="subtitle">Browse and purchase equipment for your adventures</p>
      </div>
    </div>

    <div class="currency-section">
      <div class="currency-display">
        <span class="icon">ğŸ’°</span>
        <span class="currency-amount">{{ getCurrencyDisplay() }}</span>
      </div>
      <button class="btn btn-secondary" (click)="toggleConverter()">
        <span class="icon">ğŸ’±</span>
        {{ showConverter ? 'Hide' : 'Convert' }}
      </button>
    </div>
  </div>

  <!-- Currency Converter -->
  <div class="currency-converter card" *ngIf="showConverter">
    <div class="card-header">
      <h3>Currency Converter</h3>
      <p class="card-subtitle">Exchange your currency between denominations</p>
    </div>
    <div class="card-content">
      <div class="converter-fields">
        <div class="form-field">
          <label for="broams">Broams</label>
          <input id="broams" type="number" [(ngModel)]="converterBroams" (ngModelChange)="updateFromBroams()" min="0">
          <span class="hint">1 broam = 4 marks</span>
        </div>

        <div class="form-field">
          <label for="marks">Marks</label>
          <input id="marks" type="number" [(ngModel)]="converterMarks" (ngModelChange)="updateFromMarks()" min="0">
          <span class="hint">Base currency</span>
        </div>

        <div class="form-field">
          <label for="chips">Chips</label>
          <input id="chips" type="number" [(ngModel)]="converterChips" (ngModelChange)="updateFromChips()" min="0" step="0.1">
          <span class="hint">5 chips = 1 mark</span>
        </div>
      </div>
      <button class="btn btn-primary" (click)="convertToMixed()">
        <span class="icon">ğŸ”„</span>
        Auto-Convert to Mixed
      </button>
    </div>
  </div>

  <!-- Search Bar -->
  <div class="search-bar">
    <span class="search-icon">ğŸ”</span>
    <input type="text" [(ngModel)]="searchQuery" placeholder="Search by name or description...">
  </div>

  <!-- Category Selector -->
  <div class="category-selector">
    <button 
      *ngFor="let category of categories"
      class="category-chip"
      [class.active]="selectedCategory === category.id"
      (click)="selectCategory(category.id)">
      <span class="icon">{{ getCategoryIcon(category.icon) }}</span>
      {{ category.label }}
    </button>
  </div>

  <!-- Item Grid -->
  <div class="items-grid">
    <div 
      *ngFor="let item of getAvailableItems()"
      class="item-card card"
      [class.affordable]="canAfford(item)"
      [class.expensive]="!canAfford(item)">
      
      <div class="card-header">
        <span class="item-icon" [attr.data-type]="item.type">
          {{ getItemIconEmoji(item) }}
        </span>
        <div class="header-text">
          <h3>{{ item.name }}</h3>
          <span class="item-type">{{ item.type }}</span>
        </div>
      </div>

      <div class="card-content">
        <p class="item-description">{{ item.description }}</p>
        
        <div class="item-stats" *ngIf="getItemStats(item)">
          <span class="icon">â„¹ï¸</span>
          <span>{{ getItemStats(item) }}</span>
        </div>

        <div class="item-traits" *ngIf="item.weaponProperties && item.weaponProperties.traits && item.weaponProperties.traits.length > 0">
          <span class="trait-chip" *ngFor="let trait of item.weaponProperties.traits.slice(0, 3)">
            {{ trait }}
          </span>
        </div>

        <div class="item-footer">
          <div class="item-weight">
            <span class="icon">âš–ï¸</span>
            <span>{{ item.weight }} lbs</span>
          </div>
          <div class="item-price">
            <span class="icon">ğŸ’°</span>
            <span class="price-amount">{{ item.price }}mk</span>
          </div>
        </div>
      </div>

      <div class="card-actions">
        <button 
          class="btn"
          [class.btn-primary]="canAfford(item)"
          [class.btn-disabled]="!canAfford(item)"
          [disabled]="!canAfford(item)"
          (click)="purchaseItem(item, 1)"
          [title]="canAfford(item) ? 'Purchase this item' : 'Not enough currency'">
          <span class="icon">ğŸ›’</span>
          Buy
        </button>
        
        <button 
          class="btn btn-small"
          *ngIf="item.stackable && canAfford(item, 5)"
          (click)="purchaseItem(item, 5)"
          title="Buy 5x">
          <span class="icon">ğŸ›’</span>
          5x
        </button>
      </div>
    </div>
  </div>

  <div class="empty-results" *ngIf="getAvailableItems().length === 0">
    <span class="large-icon">ğŸ”</span>
    <h2>No items found</h2>
    <p class="hint">Try a different category or search term</p>
  </div>
</div>

<!-- Store Closed Message -->
<div class="store-closed" *ngIf="!storeEnabled">
  <span class="large-icon">ğŸª</span>
  <h2>Store Closed</h2>
  <p>The store has been closed by the Game Master</p>
  <p class="hint">Check back later or ask your GM to reopen the store</p>
</div>

<!-- No Character Message -->
<div class="no-character" *ngIf="!character">
  <span class="large-icon">âš ï¸</span>
  <h2>No Character Loaded</h2>
  <p>Please load a character to access the store</p>
</div>

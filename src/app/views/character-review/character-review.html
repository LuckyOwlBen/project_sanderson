<div class="character-review-container">
  <!-- Loading State -->
  <div class="loading-state" *ngIf="isLoadingCharacter">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading character details...</p>
  </div>

  <!-- Error State -->
  <div class="error-state" *ngIf="characterLoadError && !isLoadingCharacter">
    <mat-icon class="error-icon">error_outline</mat-icon>
    <p class="error-message">{{ characterLoadError }}</p>
  </div>

  <!-- Character Review Content -->
  <div *ngIf="character && !isLoadingCharacter && !characterLoadError">
  <div class="review-header">
    <h1>Character Complete!</h1>
    <p class="subtitle">Review your character before finalizing</p>
  </div>

  <div class="review-content">
    <!-- Portrait Section -->
    <mat-card class="review-card portrait-card">
      <mat-card-header>
        <mat-icon class="section-icon">portrait</mat-icon>
        <mat-card-title>Character Portrait</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="portrait-section">
          <app-character-image
            [imageUrl]="portraitUrl"
            [characterName]="character.name || 'Character'"
            [size]="'large'"
            [showPlaceholder]="true">
          </app-character-image>
          
          <button mat-raised-button color="primary" (click)="openPortraitUpload()">
            <mat-icon>{{ portraitUrl ? 'edit' : 'add_photo_alternate' }}</mat-icon>
            {{ portraitUrl ? 'Change Portrait' : 'Add Portrait' }}
          </button>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Basic Information Card -->
    <mat-card class="review-card">
      <mat-card-header>
        <mat-icon class="section-icon">person</mat-icon>
        <mat-card-title>Basic Information</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="info-grid">
          <div class="info-item">
            <span class="label">Name:</span>
            <span class="value highlight-name">{{ character.name || 'Unnamed Hero' }}</span>
          </div>
          <div class="info-item">
            <span class="label">Level:</span>
            <span class="value">{{ character.level }}</span>
          </div>
          <div class="info-item">
            <span class="label">Ancestry:</span>
            <span class="value">{{ character.ancestry || 'None' }}</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Cultures Card -->
    <mat-card class="review-card" *ngIf="character.cultures.length > 0">
      <mat-card-header>
        <mat-icon class="section-icon">language</mat-icon>
        <mat-card-title>Cultural Background</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="chip-list">
          <span class="culture-chip" *ngFor="let culture of character.cultures">
            {{ culture.name }}
          </span>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Paths Card -->
    <mat-card class="review-card" *ngIf="character.paths.length > 0">
      <mat-card-header>
        <mat-icon class="section-icon">route</mat-icon>
        <mat-card-title>Heroic Path</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="path-display">
          <div class="path-item" *ngFor="let path of character.paths">
            <mat-icon>arrow_forward</mat-icon>
            <span>{{ path }}</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Attributes Card -->
    <mat-card class="review-card">
      <mat-card-header>
        <mat-icon class="section-icon">fitness_center</mat-icon>
        <mat-card-title>Attributes</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="attributes-display">
          <div class="attribute-box">
            <div class="attr-name">Strength</div>
            <div class="attr-value">{{ character.attributes.strength }}</div>
          </div>
          <div class="attribute-box">
            <div class="attr-name">Speed</div>
            <div class="attr-value">{{ character.attributes.speed }}</div>
          </div>
          <div class="attribute-box">
            <div class="attr-name">Intellect</div>
            <div class="attr-value">{{ character.attributes.intellect }}</div>
          </div>
          <div class="attribute-box">
            <div class="attr-name">Willpower</div>
            <div class="attr-value">{{ character.attributes.willpower }}</div>
          </div>
          <div class="attribute-box">
            <div class="attr-name">Awareness</div>
            <div class="attr-value">{{ character.attributes.awareness }}</div>
          </div>
          <div class="attribute-box">
            <div class="attr-name">Presence</div>
            <div class="attr-value">{{ character.attributes.presence }}</div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Skills Card -->
    <mat-card class="review-card">
      <mat-card-header>
        <mat-icon class="section-icon">school</mat-icon>
        <mat-card-title>Trained Skills ({{ getTrainedSkills().length }})</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="skills-display" *ngIf="getTrainedSkills().length > 0">
          <div class="skill-item" *ngFor="let skill of getTrainedSkills()">
            <span class="skill-name">{{ skill.name }}</span>
            <span class="skill-rank">Rank {{ skill.rank }}</span>
          </div>
        </div>
        <p class="empty-state" *ngIf="getTrainedSkills().length === 0">
          No skills trained
        </p>
      </mat-card-content>
    </mat-card>

    <!-- Expertises Card -->
    <mat-card class="review-card">
      <mat-card-header>
        <mat-icon class="section-icon">auto_stories</mat-icon>
        <mat-card-title>Expertises ({{ getSelectedExpertises().length }})</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="expertises-display" *ngIf="getSelectedExpertises().length > 0">
          <div class="expertise-item" *ngFor="let expertise of getSelectedExpertises()">
            <mat-icon class="expertise-icon">check_circle</mat-icon>
            <span class="expertise-name">{{ expertise.name }}</span>
            <span class="expertise-source-badge" [class]="'badge-' + expertise.source">
              {{ getExpertiseSourceBadge(expertise) }}
            </span>
          </div>
        </div>
        <p class="empty-state" *ngIf="getSelectedExpertises().length === 0">
          No expertises selected
        </p>
      </mat-card-content>
    </mat-card>

    <!-- Talents Card -->
    <mat-card class="review-card">
      <mat-card-header>
        <mat-icon class="section-icon">stars</mat-icon>
        <mat-card-title>Talents ({{ getUnlockedTalents().length }})</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="talents-display" *ngIf="getUnlockedTalents().length > 0">
          <div class="talent-item-detailed" *ngFor="let talent of getUnlockedTalents()">
            <div class="talent-header">
              <mat-icon class="talent-icon">stars</mat-icon>
              <span class="talent-name">{{ talent.name }}</span>
              <span class="talent-tier">Tier {{ talent.tier }}</span>
            </div>
            <p class="talent-description">{{ talent.description }}</p>
          </div>
        </div>
        <p class="empty-state" *ngIf="getUnlockedTalents().length === 0">
          No talents selected
        </p>
      </mat-card-content>
    </mat-card>

    <!-- Inventory Card -->
    <mat-card class="review-card" *ngIf="hasInventoryItems() || hasEquippedItems()">
      <mat-card-header>
        <mat-icon class="section-icon">shopping_bag</mat-icon>
        <mat-card-title>Starting Equipment</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <!-- Currency Display -->
        <div class="currency-display" *ngIf="character">
          <div class="currency-item">
            <mat-icon class="currency-icon">account_balance</mat-icon>
            <span class="currency-label">Currency:</span>
            <span class="currency-value">
              {{ getCurrency().broams }}b {{ getCurrency().marks }}m {{ getCurrency().chips }}c
            </span>
          </div>
        </div>

        <!-- Equipped Items -->
        <div class="equipped-section" *ngIf="hasEquippedItems()">
          <h3 class="subsection-title">
            <mat-icon>shield</mat-icon>
            Equipped Items
          </h3>
          <div class="equipped-items-list">
            <div class="equipped-item" *ngFor="let item of getEquippedItems()">
              <mat-icon class="item-icon">{{ getItemIcon(item.type) }}</mat-icon>
              <div class="item-details">
                <span class="item-name">{{ item.name }}</span>
                <span class="item-slot">{{ item.slot }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Inventory Items -->
        <div class="inventory-section" *ngIf="hasInventoryItems()">
          <h3 class="subsection-title">
            <mat-icon>inventory</mat-icon>
            Carried Items ({{ getInventoryItems().length }})
          </h3>
          <div class="inventory-items-list">
            <div class="inventory-item" *ngFor="let item of getInventoryItems()">
              <mat-icon class="item-icon">{{ getItemIcon(item.type) }}</mat-icon>
              <span class="item-name">{{ item.name }}</span>
              <span class="item-quantity" *ngIf="item.quantity && item.quantity > 1">Ã—{{ item.quantity }}</span>
            </div>
          </div>
        </div>

        <!-- Weight Display -->
        <div class="weight-display" *ngIf="character">
          <mat-icon class="weight-icon">fitness_center</mat-icon>
          <span class="weight-label">Total Weight:</span>
          <span class="weight-value">{{ getTotalWeight() }} lbs</span>
        </div>

        <p class="empty-state" *ngIf="!hasInventoryItems() && !hasEquippedItems()">
          No equipment
        </p>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Finalize Button -->
  <div class="finalize-section">
    <mat-divider></mat-divider>
    <div class="finalize-content">
      <p class="finalize-message">
        Ready to begin your adventure? Once finalized, you can export or save your character.
      </p>
      <button 
        mat-raised-button 
        color="primary" 
        class="finalize-button"
        [disabled]="isLoadingCharacter"
        (click)="finalizeCharacter()">
        <mat-icon *ngIf="!isLoadingCharacter">done_all</mat-icon>
        <mat-spinner *ngIf="isLoadingCharacter" diameter="20" style="display: inline-block; margin-right: 8px;"></mat-spinner>
        {{ isLoadingCharacter ? 'Finalizing...' : 'Finalize Character' }}

